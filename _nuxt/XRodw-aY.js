import{_ as A}from"./DwIUNiTH.js";import{I as _}from"./D364DlbC.js";import{s as M,m as B,r as F,_ as E,a as u}from"./C_sjok8z.js";import{g as C,j as G,k as L,r as p,l as x,o as g,w as c,a as s,d as T,b as f,c as P,m as r,n as b,F as W,p as Z,t as j,q as Q}from"./C7dviQKJ.js";import{u as U}from"./D_8lAbRE.js";function q(a){a.values.forEach(e=>e.stop())}function S(a,e){const o=F(e,a.options.variants,a.options.custom);Object.entries(o).forEach(([n,l])=>{n!=="transition"&&(a.target[n]=l)})}function R(){const a=new Set,e={subscribe(o){return a.add(o),()=>void a.delete(o)},start(o,n){const l=[];return a.forEach(i=>{l.push(i.animateUpdates({directAnimate:o,directTransition:n}))}),Promise.all(l)},set(o){return a.forEach(n=>{X(n,o)})},stop(){a.forEach(o=>{q(o.visualElement)})},mount(){return()=>{e.stop()}}};return e}function X(a,e){if(typeof e=="string")return I(a,[e]);if(Array.isArray(e))return I(a,e);S(a,e),M(a.visualElement,e)}function I(a,e){const o=[...e].reverse(),n=a.visualElement;o.forEach(l=>{const i=n.getVariant(l);i&&M(n,i),S(a,i),n.variantChildren&&n.variantChildren.forEach(h=>{I(B.get(h.current),e)})})}function $(){const a=R();let e;return C(()=>{e=a.mount()}),G(()=>{e()}),a}const K={id:"main"},H={class:"grow overflow-x-hidden py-24"},tt={class:"z-[1] relative flex flex-col items-center justify-center space-y-4"},et={class:"relative w-56 h-56 z-[1] my-16 flex items-center justify-center"},at={class:"text-lg"},st={class:"font-semibold text-red-600"},rt={class:"px-8 my-8"},nt={class:"bg-white rounded-xl shadow-xl shadow-neutral-400/10 p-4 w-full flex items-center gap-4"},ot={className:"self-stretch justify-start text-neutral-400 leading-relaxed"},ft=L({__name:"index",setup(a){const e=p(!1),o=$(),n=p(0),l=p(!1),i=U(),h=async()=>{e.value||(n.value=1,e.value=!0,await o.start({scale:.85,backgroundImage:"linear-gradient(180deg, #DE2729, #FD8180)",transition:{duration:.1,type:"spring",stiffness:300,damping:10}}),e.value&&(await o.start({scale:1.5,backgroundImage:"linear-gradient(0deg, #DE2729, #FD8180)",transition:{duration:.1,type:"spring",stiffness:300,damping:10}}),e.value&&(o.start({scale:5,backgroundImage:"linear-gradient(180deg, #DE2729, #FD8180)",transition:{duration:.1,type:"spring",stiffness:300,damping:12}}),i.called=!0,n.value=2,O(),J())))},O=async()=>{e.value=!1,n.value=0,i.called||(l.value=!0,setTimeout(()=>{l.value=!1},2e3)),await o.start({scale:1,backgroundImage:"linear-gradient(0deg, #DE2729, #FD8180)",transition:{type:"spring",stiffness:300,damping:20}})},w=p(null),k=p(null),v=p(""),D=p(null),N=p(new Date().toISOString().slice(0,10).replace(/-/g,"")+Math.floor(Math.random()*1e5)),z=async()=>{if(!navigator.geolocation){v.value="Geolocation is not supported by your browser.";return}navigator.geolocation.getCurrentPosition(async m=>{w.value=m.coords.latitude,k.value=m.coords.longitude;const t=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${w.value}&lon=${k.value}`;try{const d=await(await fetch(t,{headers:{"User-Agent":"panic-call-app"}})).json();v.value=d.display_name||"Address not found"}catch{v.value="Failed to fetch address"}},m=>{v.value="Unable to retrieve your location"})};C(async()=>{await z()});const J=async()=>{const m={id:2,address:v.value,lat:w.value,long:k.value,ticket:N.value},t=y=>new Promise(d=>setTimeout(d,y));await $fetch("https://d5af-202-146-144-126.ngrok-free.app/api/send-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m),async onResponse({request:y,response:d,options:it}){if(d.status===200){i.response_data=null;try{await t(2e3),i.response_data=d._data,i.ticket_progress=1,await t(1e3),D.value=await Y(),i.ticket_progress=2,await t(1e3),i.ticket_progress=3,await t(1e3),i.called=!1,D.value=null,i.ticket_progress=0,Q().push("/history")}catch(V){console.error("Error processing response sequence:",V),i.called=!1}}}})},Y=async()=>await $fetch("https://d5af-202-146-144-126.ngrok-free.app/api/ticket-detail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({no_tiket:N.value})});return(m,t)=>{const y=A;return g(),x(y,null,{default:c(()=>[s("div",K,[s("div",H,[s("div",tt,[t[6]||(t[6]=s("h1",{class:"text-center text-4xl text-neutral-800 font-bold"},[T(" Anda Butuh "),s("br"),T(" Bantuan Darurat? ")],-1)),t[7]||(t[7]=s("p",{class:"text-lg"},"Tahan tombol telepon untuk memangil",-1)),s("div",et,[f(r(E),null,{default:c(()=>[r(l)&&r(n)==0?(g(),x(r(u).div,{key:0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},class:"absolute z-10 -top-8 text-neutral-200 bg-neutral-900 shadow-lg shadow-neutral-400/10 rounded-md p-4 text-center"},{default:c(()=>t[2]||(t[2]=[s("p",{class:"text-sm"},"Panggilan dibatalkan",-1),s("div",{class:"absolute -bottom-2 left-1/2 rotate-180 -translate-x-1/2 w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-b-[8px] border-b-neutral-900"},null,-1)])),_:1})):b("",!0),r(n)!=0&&!r(l)?(g(),x(r(u).div,{key:1,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},class:"absolute z-10 font-medium -bottom-8 text-neutral-600 bg-white shadow-lg shadow-neutral-400/10 rounded-md p-4 text-center"},{default:c(()=>t[3]||(t[3]=[s("p",{class:"text-sm"},"Tahan Selama 3 Detik",-1),s("div",{class:"absolute -top-2 left-1/2 -translate-x-1/2 w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-b-[8px] border-b-white"},null,-1)])),_:1})):b("",!0)]),_:1}),f(r(u).div,{animate:r(o),initial:{scale:1,backgroundImage:"linear-gradient(0deg, #DE2729, #FD8180)"},onPressStart:t[0]||(t[0]=d=>h()),onPress:t[1]||(t[1]=d=>O()),class:"relative group w-full h-full rounded-full flex items-center justify-center shadow-lg"},{default:c(()=>[t[4]||(t[4]=s("svg",{class:"absolute pointer-events-none w-full h-full z-10 scale-95",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"80px",height:"80px",viewBox:"0 0 80 80","xml:space":"preserve"},[s("circle",{transform:"rotate(-90 40 40)",class:"another-circle",cx:"40",cy:"40",r:"36",fill:"transparent",stroke:"white","stroke-width":"2"})],-1)),f(r(E),null,{default:c(()=>[r(n)==0?(g(),x(r(u).div,{key:0,class:"absolute",initial:{opacity:0,rotate:"180deg"},animate:{opacity:1,rotate:0},exit:{filter:"blur(8px)",opacity:0}},{default:c(()=>[f(r(u).div,null,{default:c(()=>[f(r(_),{class:"text-8xl text-white",icon:"ri:phone-fill"})]),_:1})]),_:1})):b("",!0),r(n)==1?(g(),x(r(u).div,{key:1,class:"absolute",initial:{opacity:0,rotate:"180deg"},animate:{opacity:1,rotate:0},exit:{filter:"blur(8px)",opacity:0}},{default:c(()=>[f(r(_),{class:"text-8xl text-white",icon:"material-symbols:support-agent-rounded"})]),_:1})):b("",!0),r(n)==2?(g(),x(r(u).div,{key:2,class:"absolute",initial:{opacity:0,rotate:"180deg"},animate:{opacity:1,rotate:0},exit:{filter:"blur(8px)",opacity:0}},{default:c(()=>[f(r(_),{class:"text-8xl text-white",icon:"ph:waveform"})]),_:1})):b("",!0)]),_:1})]),_:1},8,["animate"]),(g(),P(W,null,Z(3,d=>f(r(u).div,{key:d,initial:{scale:0,opacity:0},animate:{scale:2,opacity:[1,1,0]},transition:{duration:3,delay:d*.75,repeat:1/0,repeatType:"loop",repeatDelay:.1},class:"absolute -z-10 w-full h-full rounded-full bg-red-200"},null,8,["transition"])),64))]),s("p",at,[t[5]||(t[5]=T(" Ticket Ref ")),s("span",st,"#"+j(new Date().toISOString().slice(0,10).replace(/-/g,"")+Math.floor(Math.random()*1e5)),1)])]),s("div",rt,[s("div",nt,[t[9]||(t[9]=s("div",{class:"w-20 shrink-0 aspect-square overflow-hidden bg-neutral-200 rounded-full"},[s("img",{class:"w-full h-full object-cover",src:"https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/1de9b8f5-928d-4e9d-bc14-f2440933b095/dfi578x-1a2fb1f9-4d2e-4dcc-ac55-f9bb3d873796.png/v1/fill/w_894,h_894,q_70,strp/fx_00000_by_stdarkphantom_dfi578x-pre.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9MTA4MCIsInBhdGgiOiJcL2ZcLzFkZTliOGY1LTkyOGQtNGU5ZC1iYzE0LWYyNDQwOTMzYjA5NVwvZGZpNTc4eC0xYTJmYjFmOS00ZDJlLTRkY2MtYWM1NS1mOWJiM2Q4NzM3OTYucG5nIiwid2lkdGgiOiI8PTEwODAifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6aW1hZ2Uub3BlcmF0aW9ucyJdfQ.myXNBrso-GtY4IWU-BFPZI85dzqEKW7Tj_CxbRHFf2k",alt:"Profile Picture"})],-1)),s("div",null,[t[8]||(t[8]=s("p",{class:"text-neutral-700 font-semibold"},"Lokasimu Saat Ini",-1)),s("div",ot,j(r(v)),1)])])])])])]),_:1})}}});export{ft as default};
